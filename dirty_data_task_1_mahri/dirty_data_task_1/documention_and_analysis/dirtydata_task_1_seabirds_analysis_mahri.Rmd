---
title: "1.3 Task 3 - Sea bird observation data"
output: html_notebook
---
```{r}
library(tidyverse)
library(readxl)

ship_data_by_record <- read_excel("../raw_data/seabirds.xls")
bird_data_by_record <- read_excel("../raw_data/seabirds.xls", sheet = 2)

ship_data_codes <- read_excel("../raw_data/seabirds.xls", sheet = 3)
bird_data_codes <- read_excel("../raw_data/seabirds.xls", sheet = 4)
```

- No meta data to remove. Looking at data types. 
- Looks like I don't need the code sheets (sheets 3 & 4) apart from for working out 
what columns to keep in the first 2

```{r}

glimpse(ship_data_by_record)
# 27 cols, 12,310 rows 

glimpse(bird_data_by_record)
# 26 cols, 49,019 rows

names(ship_data_by_record)
names(bird_data_by_record)
# both have RECORD and RECORD ID (match on Record ID - lots in birds match with 1 in ship)

```
Clean - rename and select columns that are relevant to the questions 

```{r}
library(janitor)

ship_data_records <- janitor::clean_names(ship_data_by_record)
bird_data_records <- janitor::clean_names(bird_data_by_record)

# BIRDS 

bird_data_renamed <- bird_data_records %>%
  rename("species_common_name" = "species_common_name_taxon_age_sex_plumage_phase",
         "species_scientific_name" = "species_scientific_name_taxon_age_sex_plumage_phase",
         "birds_counted" = "count") %>% 
  select(record, 
        record_id, 
        species_common_name, 
        species_scientific_name, 
        species_abbreviation, 
        birds_counted)

bird_data_renamed


# SHIPS 

ship_data_renamed <- ship_data_records %>% 
  rename("latitude" = "lat", 
         "longitude" = "long") %>% 
  select(record, 
         record_id, 
         date,
         latitude, 
         longitude)

ship_data_renamed
```

Join 
```{r}

birds_and_ships_joined <- left_join(bird_data_renamed, 
                                    ship_data_renamed, by = "record_id") %>% 
  rename("record_num_birds"= record.x, "record_num_ship" = record.y)  %>% 
  relocate(birds_counted, .before = 1) %>% 
  relocate(record_num_birds, .before = 7)

birds_and_ships_joined
```



Clean - drop appropriate NAs for the questions

```{r}

birds_and_ships_joined %>% 
  arrange(!is.na(birds_counted)) %>% 
  summarise(count = sum(is.na(birds_counted)))
# there are 2699 records where bird count = NA 

birds_and_ships <- birds_and_ships_joined %>% 
  drop_na(birds_counted)

birds_and_ships %>% 
  summarise(count = sum(is.na(birds_counted)))
# No NAs in bird count 

birds_and_ships
# note there are some bird names (all 3 types) as NA and some latitudes (28) as 
# NA, but I'll wait and see if that's an issue later?.
```

Check again all columns are correct type 
```{r}
glimpse(birds_and_ships)


library(assertr)
birds_and_ships %>% 
  verify(latitude >= -90 & latitude <= 90)
birds_and_ships %>% 
  verify(longitude >= -180 & longitude <= 180)
# there are 28 latitude failures and 29 longitude failures... 

birds_and_ships %>% 
  summarise(count = sum(is.na(latitude)))
# there are 28 NA latitude values 
birds_and_ships %>% 
  summarise(count = sum(is.na(longitude)))
# there are 29 NA longitude values

birds_and_ships %>% 
  arrange(!is.na(latitude))
# They all have quite small bird count numbers so I don't think it is an issue 
# for the latitude question.
# Small numbers are probably needed for the solo sightings question.
```





1.3.2 Analysis questions

For each question where we ask for bird names, give the birdâ€™s common name, 
scientific name and species abbreviation.

1. Which bird had the most individual sightings?

```{r}

# I'm not exactly sure what the question is asking for but here are two options: 

#1. Looking for the species of bird that was spotted on the most occasions (1 or 
# more of them spotted at once):
# Common Name: Wandering albatross sensu lato PL2
# Scientific Name: Diomedea antipodensis / exulans PL2
# Species Abbreviation: DIOANTEXU PL2
# This species of bird was spotted on 3099 separate occasions 

birds_and_ships %>% 
  select(species_abbreviation, 
         species_common_name,
         species_scientific_name,
         birds_counted, 
         record_id) %>% 
  group_by(species_common_name) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))
  

# 2. For sightings of lone birds, which was observed the most:  
# Common Name: Wandering albatross sensu lato PL3
# Scientific Name: Diomedea antipodensis / exulans PL3
# Species Abbreviation: DIOANTEXU PL3
# This species of bird was spotted on it's own on 1707 separate occasions
birds_and_ships %>% 
  select(species_abbreviation, 
         species_common_name,
         species_scientific_name,
         birds_counted, 
         record_id) %>% 
  filter(birds_counted == 1) %>% 
  group_by(species_common_name) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))


```


2. Which bird had the highest total count?

```{r}
birds_and_ships %>% 
  group_by(species_common_name) %>% 
  summarise(n_birds = sum(birds_counted)) %>% 
  arrange(desc(n_birds))
  
# Common Name: Short-tailed shearwater
# Scientific Name: Puffinus tenuirostris
# Species Abbreviation: PUFTEN
# This bird had a total count of 982,553


```


3. Which bird had the highest total count above a latitude of -30?

```{r}

birds_and_ships %>% 
  select(species_abbreviation, 
         species_common_name,
         species_scientific_name,
         birds_counted, 
         latitude,
         record_id) %>% 
  filter(latitude > -30) %>% 
  group_by(species_common_name) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))

# Common Name: Wedge-tailed shearwater.
# Scientific Name: Puffinus pacificus.
# Species Abbreviation: PUFPAC.
# This bird was seen alone or in groups above a latitude of -30 on 29 occasions 
# but an individual count can be seen below:

birds_and_ships %>% 
  select(species_abbreviation, 
         species_common_name,
         species_scientific_name,
         birds_counted, 
         latitude,
         record_id) %>% 
  filter(latitude > -30) %>% 
  group_by(species_common_name) %>% 
  summarise(n_birds = sum(birds_counted)) %>% 
  arrange(desc(n_birds))

# Common Name: Wedge-tailed shearwater.
# Scientific Name: Puffinus pacificus.
# Species Abbreviation: PUFPAC.
# 855 individuals (alone or in groups) were seen above a latitude of -30
```

4. How many different types of birds were only ever seen in groups of 1?

Plan:
1. Select bird name and birds counted.
2. Pivot wider so that rows are bird type and there's 3 more columns for:
<1 for == 1 and for >1.
3. Find only those with resutls in column == 1

some notes
```{r}

birds_and_ships %>% 
  select(species_abbreviation, 
         species_common_name,
         species_scientific_name,
         birds_counted, 
         record_id) %>% 
  filter(birds_counted == 1) %>% 
  group_by(species_common_name, birds_counted) %>% 
  summarise(count = n()) 
  
# 298 different types of birds were seen on their own... but ONLY EVER SEEN?

birds_and_ships %>% 
  select(species_abbreviation, 
         species_common_name,
         species_scientific_name,
         birds_counted, 
         record_id) %>% 
  filter(birds_counted > 1) %>% 
  group_by(species_common_name, birds_counted) %>% 
  summarise(count = n())
# 232 different types of birds were seen in pairs/groups

```

trying things out
```{r}
single_sightings <- birds_and_ships %>% 
  select(species_common_name, birds_counted) %>% 
  arrange(species_common_name) %>%
  mutate(lone_birds = (birds_counted == 1)) 
single_sightings

single_sightings %>% 
  pivot_wider(names_from = lone_birds, 
              values_from = birds_counted) 


# NEED TO COME BACK TO THIS 
```



5. How many penguins were seen? (Hint: there are many types of penguin)
```{r}
#pattern <- regex("big +brother", ignore_case = TRUE)

#whole_text %>%
 # str_extract_all(pattern) %>%
#  flatten_chr() %>%
#  length()


penguin_pattern <- "[*][pP]enguin"


penguins <- birds_and_ships %>% 
  str_detect(penguin_pattern) %>% 
  length()
penguins
# the above gives 9 false and 1 true. and then a length of 10... there are 9

penguins_seen <- birds_and_ships %>% 
#  select(birds_counted, species_common_name) %>% 
  filter(species_common_name %in% c("Penguin", "penguin")) 

#penguins <- birds_and_ships %>% 
 # str_extract_all(penguin_pattern) %>% 
  #flatten_chr() %>% 
  #length()


#  select(species_common_name, birds_counted) %>% 
 # filter(str_extract(penguin_pattern))
# penguins




# penguins <- birds_and_ships %>% 
#  filter(species_common_name %in% c("Penguin", "penguin"))

# penguins


# penguin_pattern <- "[pP]enguin"

# Common Name:
# Scientific Name: 
# Species Abbreviation: 
```



